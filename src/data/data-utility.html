<!--
@license
Copyright (c) 2017 Swarm City
This code may only be used under the license found at https://github.com/swarmcity/license
-->
<link rel="import" href="../../bower_components/polymer/polymer-element.html">


<!--
An element that provides simple access to local storage. 
An acocunt is a javscript object representing the users account.
Within the account data we will save the encrypted vault.
All functions return a promise.

HTML Example:
```
<data-utility id="util"></data-utility>
```
JS Example
```
this.$.util.translationExists(language)
.then((found) => {
    console.log(found) 
})
```

-->

<dom-module id="data-utility">
    <script>
        class DataUtility extends Polymer.Element {
            static get is() { return 'data-utility'; }

/**
* Checks if we have the translation for the language
* @param {language} language to check
* @return {boolean} true signals we do have a translation, false we dont.
*/
    translationExists(language) {
        return new Promise((resolve, reject) => {
            // Load the translations.json file
            const xobj = new XMLHttpRequest();
            xobj.overrideMimeType('application/json');
            xobj.open('GET', '../src/text-translations.json', true);
            xobj.onreadystatechange = () => {
                if (xobj.readyState == 4 && xobj.status == '200') {
// The file loaded now check the index to determine if wehave a translation
                    const json = JSON.parse(xobj.responseText);
                    const keys = Object.keys(json);
                    const arr = keys.indexOf(language);
                    if(arr != -1) {
                        resolve({language: language, found: true});
                    } else {
                        resolve({language: language, found: false});
                    }
                }
            };
            // Request the json
            xobj.send(null);
        });
    }

/**
* If we need to display buttons for the user to select languages,
* get the languages we have translations for and supply the dom repeat
* @return {locales} locales is the loacal name of the language
*/
    allLanguages() {
        return new Promise((resolve, reject) => {
            // Load the translations.json file
            const xobj = new XMLHttpRequest();
            xobj.overrideMimeType('application/json');
            xobj.open('GET', '../src/text-translations.json', true);
            xobj.onreadystatechange = () => {
                if (xobj.readyState == 4 && xobj.status == '200') {
                    // Parse the response
                    const json = JSON.parse(xobj.responseText);
                    const count = (Object.keys(json).length);
                    // Setup the arrays t be used in the dom repeat
                    let locales = [];
                    let iso = [];
                    // loop over the object and push the keys
                    var i;
                    for (i = 0; i < count; i++) {
                    locales.push(json[Object.keys(json)[i]].locale);
                    iso.push(json[Object.keys(json)[i]].language);
                    }
                    resolve({locales: locales, iso: iso});
                }
            };
            xobj.send(null);
        });
    }
        } window.customElements.define(DataUtility.is, DataUtility);
    </script>
</dom-module>
