<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<dom-module id="data-local-storage">
    <script>
        class DataLocalStorage extends Polymer.Element {
            static get is() { return 'data-local-storage'; }

// Public functions have no logic they just pass data around
            accountExists() {
                return new Promise((resolve, reject) => {
                    this._read()
                    .then((acocuntExists) => {
                        resolve(acocuntExists);
                    })
                    .catch((err) => {
                        reject(Error(err));
                    });
                });
            }
            saveAccount(data) {
                return new Promise((resolve, reject) => {
                    const account = data;
                    this._write(account)
                    .then((account) => {
                        resolve(account);
                    })
                    .catch((err) => {
                        reject(Error(err));
                    });
                });
            }
            removeAccount() {
                return new Promise((resolve, reject) => {
                    this._delete()
                    .then((status) => {
                        resolve(status);
                    })
                    .catch((err) => {
                        reject(Error(err));
                    });
                });
            }

// Private functions do not call from outside this file
            _read() {
                return new Promise((resolve, reject) => {
                    if (typeof(Storage) !== 'undefined') {
                        const account = localStorage.getItem('SwarmCity');
                        if(!account) {
                            resolve(false);
                        } else {
                            resolve(true);
                        }
                    } else {
                        reject(Error('This browser does not support local storage'));
                    }
                });
            }
            _write(data) {
                return new Promise((resolve, reject) => {
                    const json = JSON.stringify(data);
                    if (typeof(Storage) !== 'undefined') {
                        localStorage.SwarmCity = json;
                        resolve(JSON.parse(localStorage.getItem('SwarmCity')));
                    } else {
                        reject(Error('This browser does not support local storage'));
                    }
                });
            }
            _delete() {
                return new Promise((resolve, reject) => {
                    if (typeof(Storage) !== 'undefined') {
                        localStorage.removeItem('SwarmCity');
                        resolve(true);
                    } else {
                        reject(Error('This browser does not support local storage'));
                    }
                });
            }

        } window.customElements.define(DataLocalStorage.is, DataLocalStorage);
    </script>
</dom-module>
